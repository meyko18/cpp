# TCP/IP协议相关

## TCP和UDP的区别?说一下它们的报文格式?
TCP（传输控制协议）和UDP（用户数据报协议）是两种常用的网络传输协议，它们在传输方式和用途上有显著的区别：

1.  **连接方式**:

    *   **TCP** 是一种面向连接的协议，它在数据传输之前需要建立连接。这意味着两个使用TCP通信的设备必须首先进行握手，建立连接后才开始数据传输。
    *   **UDP** 是一种无连接协议，它不需要建立连接就可以发送数据。因此，UDP传输速度更快，但不保证数据的完整性和顺序。
2.  **数据传输可靠性**:
    *   **TCP** 提供可靠的数据传输，确保数据包按顺序到达并且没有丢失或损坏。它通过序号、确认应答、重传机制和流量控制等机制实现这一点。
    *   **UDP** 不保证数据包的顺序、完整性或不重复。如果数据包在传输过程中丢失，UDP不会尝试恢复它。
3.  **使用场景**:

    *   **TCP** 适用于对数据完整性和顺序有严格要求的应用，如网页浏览、文件传输、电子邮件等。
    *   **UDP** 通常用于对实时性要求较高的应用，如在线视频和音频流、实时游戏等，这些应用可以容忍一定程度的数据丢失。
4.  **报文格式**:

    *   **TCP报文** 包括源端口号、目的端口号、序列号、确认号、数据偏移、保留位、标志位（如SYN、ACK、FIN）、窗口大小、校验和、紧急指针和可选的数据。
    *   **UDP报文** 结构更简单，包括源端口号、目的端口号、长度和校验和。


## TCP的流量控制和和拥塞控制? TCP如何实现可靠性传输?
TCP（传输控制协议）是一个面向连接的协议，旨在确保网络通信的可靠性和有效性。TCP实现可靠性传输的几个关键机制包括流量控制、拥塞控制以及其他几个重要特性。

1.  **流量控制**:

    *   流量控制是为了避免发送方发送数据过快，导致接收方来不及处理而溢出。TCP使用滑动窗口机制来实现流量控制。
    *   滑动窗口是一个可变大小的窗口，它根据接收方的处理能力调整其大小。发送方根据窗口大小控制其发送数据的量。
2.  **拥塞控制**:

    *   拥塞控制则是防止过多的数据注入到网络中，造成网络本身的拥塞。
    *   TCP使用几种算法来实现拥塞控制，如慢开始（Slow Start）、拥塞避免（Congestion Avoidance）、快重传（Fast Retransmit）和快恢复（Fast Recovery）。
    *   在慢开始和拥塞避免阶段，TCP动态调整其拥塞窗口的大小，以控制在特定时间内注入网络的数据量。
3.  **可靠性传输**:

    *   **序列号和确认应答（ACK）**：每个TCP报文段都包含一个序列号，接收方通过发送确认应答来确认已经成功接收到特定的报文段。
    *   **重传机制**：如果发送方在合理的超时时间内没有收到确认应答，它会重新发送该数据包。
    *   **数据校验**：TCP报文头包含校验和，以检测数据在传输过程中是否发生了错误。
    *   **有序交付**：由于TCP报文段可能会在网络中乱序，TCP在接收方重组这些数据，确保按正确的顺序交付给应用层。


## 为什么连接是3次握手，关闭是4次挥手?
TCP连接的建立（三次握手）和关闭（四次挥手）是为了确保数据传输的可靠性和正确的连接管理。它们的具体步骤反映了TCP的设计原则，即可靠性和顺序保证。

### 三次握手（建立连接）

1.  **第一次握手**：客户端向服务器发送一个SYN（同步序列编号）报文，并进入SYN\_SENT状态，等待服务器确认。

2.  **第二次握手**：服务器接收到客户端的SYN报文后，发送一个SYN+ACK（确认）报文。此时，服务器进入SYN\_RCVD状态。

3.  **第三次握手**：客户端接收到服务器的SYN+ACK报文后，向服务器发送ACK报文。此时，客户端进入ESTABLISHED状态。当服务器接收到这个ACK报文后，也进入ESTABLISHED状态。

这三次握手确保了双方都知道对方已准备好进行通信。

### 四次挥手（关闭连接）

1.  **第一次挥手**：当通信结束时，主动关闭连接的一方（假设是客户端）发送一个FIN（结束）报文。

2.  **第二次挥手**：服务器接收到这个FIN报文后，发送一个ACK报文，确认收到了客户端的终止请求。

3.  **第三次挥手**：服务器准备好关闭连接时，发送一个FIN报文给客户端。

4.  **第四次挥手**：客户端接收到服务器的FIN报文后，发送一个ACK报文作为回应，并进入TIME\_WAIT状态以确保服务器接收到了ACK报文。

连接关闭需要四次挥手主要是因为TCP是全双工的，即数据可以在两个方向上同时传输。因此，关闭连接时，每个方向上的连接都需要单独终止，这就需要两次挥手。总共两个方向，因此需要四次挥手。

### 总结

*   **三次握手** 确保双方都准备好了数据传输。
*   **四次挥手** 是因为每个方向的连接终止都需要两次挥手，所以总共需要四次。



## 7层模型与4层模型的区别? 每一层的作用是什么?
7层模型通常指的是OSI（开放系统互连）模型，而4层模型则指的是TCP/IP模型。
### OSI七层模型

OSI模型由七个层次组成，每层都有其特定的功能：

1.  **物理层（Physical Layer）**：

    *   负责传输原始的比特流（0和1）。
    *   包括电缆、光纤、无线传输等物理媒介。
2.  **数据链路层（Data Link Layer）**：

    *   负责在网络实体间建立、维护和解除数据链路。
    *   包括帧同步、MAC（介质访问控制）、错误控制等。
3.  **网络层（Network Layer）**：

    *   负责数据包从源到目的地的传输和路由选择。
    *   包括IP（互联网协议）、路由选择等。
4.  **传输层（Transport Layer）**：

    *   负责提供端到端的通信服务。
    *   包括TCP（传输控制协议）和UDP（用户数据报协议）。
5.  **会话层（Session Layer）**：

    *   负责在网络中的两节点之间建立、管理和终止会话。
6.  **表示层（Presentation Layer）**：

    *   负责数据的翻译、加密和压缩。
    *   确保传输的数据能被接收方正确读取。
7.  **应用层（Application Layer）**：

    *   是最接近用户的层，负责处理特定的应用程序细节。
    *   包括HTTP、FTP、SMTP等协议。

### TCP/IP四层模型

TCP/IP模型通常被划分为四层，每层也有其专门的职责：

1.  **网络接口层（Network Interface Layer）**：

    *   相当于OSI模型的物理层和数据链路层。
    *   负责物理地址寻址、数据的封装等。
2.  **互联网层（Internet Layer）**：

    *   相当于OSI的网络层。
    *   负责数据包的传输和路由，包括IP协议。
3.  **传输层（Transport Layer）**：

    *   与OSI模型中的传输层相同。
    *   负责端到端的通信，包括TCP和UDP。
4.  **应用层（Application Layer）**：

    *   相当于OSI模型的会话层、表示层和应用层的功能。
    *   负责用户的网络应用，如HTTP、FTP等。

### 区别

*   **层数不同**：OSI模型更为详细，共有七层；TCP/IP模型则更为简化，只有四层。
*   **应用范围**：OSI模型是一个理论上的模型，旨在标准化网络的不同方面；而TCP/IP模型是基于实际应用的，更多地被用于实际的网络通信中。
*   **实用性**：OSI模型在概念上很有帮助，用于帮助理解网络功能的分层和职责；TCP/IP模型由于其简洁性和实用性，在互联网的实际应用中更为广泛。


## 交换机与路由器的区别?
交换机（Switch）和路由器（Router）都是网络设备，用于连接和管理不同网络设备之间的通信。

### 交换机（Switch）

1.  **工作层级**：

    *   交换机通常工作在OSI模型的数据链路层（第2层），但也有工作在网络层（第3层）的多层交换机。
2.  **功能**：

    *   交换机的主要功能是在同一网络或子网内部转发信息。
    *   它通过MAC地址学习和维护设备的MAC地址表，根据MAC地址将数据精确地发送到目的地。
3.  **性能**：

    *   交换机可以增加网络的带宽，减少冲突域，提高网络的整体性能。
4.  **适用场景**：

    *   交换机适合用于局域网（LAN）中，连接各种网络设备，如电脑、打印机等。

### 路由器（Router）

1.  **工作层级**：

    *   路由器工作在OSI模型的网络层（第3层）。
2.  **功能**：

    *   路由器的主要功能是连接不同的网络，如连接局域网（LAN）和广域网（WAN）。
    *   它使用IP地址和路由表来确定数据的最佳路径，并将数据转发到其他网络。
3.  **性能**：

    *   路由器可以实现网络间的互联，进行数据包的路径选择，同时提供NAT（网络地址转换）和防火墙等功能。
4.  **适用场景**：

    *   路由器适合用于将多个网络连接在一起，如连接家庭或办公室网络到互联网。

### 主要区别

*   **工作层级**：交换机主要在数据链路层工作，而路由器在网络层工作。
*   **功能和用途**：交换机主要用于同一网络内部的数据转发，侧重于网络内部的效率和性能；路由器则用于不同网络间的通信，负责数据的路由和网络间的连接。
*   **地址类型**：交换机使用MAC地址进行数据转发，而路由器使用IP地址进行数据路由。
*   **扩展性**：路由器可以连接不同的网络，形成更大的网络体系，而交换机主要用于扩展单个网络的规模。